# Тесты для симуляции движения шара

## Описание

Данный модуль содержит тесты для проверки корректности физической модели движения шара. Все тесты основаны на аналитических решениях задач классической механики.

## Структура тестов

### 1. TestBallPhysics - Основные физические свойства

#### 1.1 Кинетическая энергия (`test_kinetic_energy`)

**Аналитическое решение:**

Полная кинетическая энергия шара складывается из поступательной и вращательной компонент:

```
E_k = E_поступ + E_вращ = (1/2)·m·v² + (1/2)·I·ω²
```

Для сплошного шара момент инерции:
```
I = (2/5)·m·r²
```

**Проверка:** Сравнение численного результата с аналитической формулой.

#### 1.2 Момент инерции (`test_moment_of_inertia`)

**Аналитическое решение:**

Для однородного сплошного шара:
```
I = (2/5)·m·r²
```

**Проверка:** Прямое сравнение с формулой.

---

### 2. TestInclineMotion - Движение по наклонной плоскости

#### 2.1 Ускорение при качении без проскальзывания (`test_acceleration_no_slip`)

**Аналитический вывод:**

Рассмотрим шар массой m и радиусом r, катящийся по наклонной плоскости с углом θ.

Уравнения движения:
1. Поступательное движение центра масс:
   ```
   m·a = m·g·sin(θ) - f
   ```
   где f - сила трения

2. Вращательное движение:
   ```
   I·α = f·r
   ```
   где α - угловое ускорение

3. Условие качения без проскальзывания:
   ```
   a = α·r
   ```

Подставляем момент инерции I = (2/5)·m·r² и условие качения α = a/r:

```
(2/5)·m·r²·(a/r) = f·r
f = (2/5)·m·a
```

Подставляем в первое уравнение:
```
m·a = m·g·sin(θ) - (2/5)·m·a
m·a·(1 + 2/5) = m·g·sin(θ)
m·a·(7/5) = m·g·sin(θ)
```

**Итоговая формула:**
```
a = (5/7)·g·sin(θ) ≈ 0.714·g·sin(θ)
```

**Проверка:** Измерение ускорения в начале движения и сравнение с формулой.

#### 2.2 Конечная скорость при скатывании (`test_final_velocity_no_slip`)

**Аналитический вывод через закон сохранения энергии:**

Начальная энергия (на высоте h):
```
E₀ = m·g·h
```

Конечная энергия (внизу):
```
E = (1/2)·m·v² + (1/2)·I·ω²
```

Для качения без проскальзывания: v = ω·r, следовательно ω = v/r

Подставляем:
```
E = (1/2)·m·v² + (1/2)·(2/5)·m·r²·(v/r)²
E = (1/2)·m·v² + (1/5)·m·v²
E = (7/10)·m·v²
```

Из закона сохранения энергии:
```
m·g·h = (7/10)·m·v²
```

**Итоговая формула:**
```
v = √[(10/7)·g·h] ≈ 1.195·√(g·h)
```

где h = s·sin(θ), s - расстояние вдоль наклонной.

**Проверка:** Сравнение скорости после прохождения расстояния s с формулой.

---

### 3. TestEnergyConservation - Сохранение энергии

#### 3.1 Сохранение полной энергии на наклонной (`test_energy_conservation_incline`)

**Аналитическое обоснование:**

При качении без проскальзывания трение не совершает работу (точка контакта неподвижна), поэтому полная механическая энергия сохраняется:

```
E_полн = E_кин + E_пот = const
E_кин = (1/2)·m·v² + (1/2)·I·ω²
E_пот = m·g·h
```

**Проверка:** Вычисление полной энергии в каждый момент времени и проверка отклонения от начального значения (должно быть < 5%).

#### 3.2 Потеря энергии при трении (`test_energy_loss_with_friction`)

**Аналитическое обоснование:**

На горизонтальной поверхности при качении с трением происходит потеря энергии. Работа силы трения:

```
A = -f·s
```

Шар должен остановиться, когда вся кинетическая энергия перейдет в тепло.

**Проверка:** 
- Конечная энергия < начальной энергии
- Конечная скорость ≈ 0

---

### 4. TestCollisions - Столкновения

#### 4.1 Упругое столкновение со стеной (`test_elastic_wall_collision`)

**Аналитическое решение:**

При упругом столкновении (коэффициент восстановления e = 1) со стеной:
- Нормальная компонента скорости отражается: v_n' = -v_n
- Тангенциальная компонента сохраняется: v_t' = v_t

Для перпендикулярного удара:
```
v' = -e·v = -v  (при e=1)
```

**Проверка:** Изменение знака скорости после столкновения.

#### 4.2 Сохранение импульса при столкновении шаров (`test_momentum_conservation_ball_collision`)

**Аналитическое обоснование:**

При столкновении двух шаров в отсутствие внешних сил полный импульс системы сохраняется:

```
p⃗₁ + p⃗₂ = p⃗₁' + p⃗₂' = const
m₁·v⃗₁ + m₂·v⃗₂ = m₁·v⃗₁' + m₂·v⃗₂'
```

Для упругого столкновения также сохраняется кинетическая энергия:
```
(1/2)·m₁·v₁² + (1/2)·m₂·v₂² = (1/2)·m₁·v₁'² + (1/2)·m₂·v₂'²
```

**Проверка:** Сравнение суммарного импульса до и после столкновения.

---

### 5. TestSlippingCondition - Условия проскальзывания

#### 5.1 Проскальзывание на крутом склоне (`test_slipping_on_steep_incline`)

**Аналитический вывод:**

Условие качения без проскальзывания: сила трения не должна превышать максимальную силу трения покоя.

Максимальная сила трения покоя:
```
f_max = μ·N = μ·m·g·cos(θ)
```

Требуемая сила трения для качения без проскальзывания (из раздела 2.1):
```
f_требуемая = (2/7)·m·g·sin(θ)
```

Условие качения без проскальзывания:
```
f_требуемая ≤ f_max
(2/7)·m·g·sin(θ) ≤ μ·m·g·cos(θ)
(2/7)·tan(θ) ≤ μ
tan(θ) ≤ (7/2)·μ
```

**Критический угол:**
```
θ_крит = arctan[(7/2)·μ]
```

При θ > θ_крит начинается проскальзывание.

**Проверка:** 
- Для θ = 60° и μ = 0.1: tan(60°) ≈ 1.73, (7/2)·0.1 = 0.35
- 1.73 > 0.35 ⟹ должно быть проскальзывание

---

## Запуск тестов

### Запуск всех тестов:
```bash
python tests/test_ball_physics.py
```

### Запуск конкретного класса тестов:
```bash
python -m unittest tests.test_ball_physics.TestInclineMotion
```

### Запуск конкретного теста:
```bash
python -m unittest tests.test_ball_physics.TestInclineMotion.test_acceleration_no_slip
```

## Критерии успешности тестов

- **Относительная погрешность < 5%** для численных методов интегрирования
- **Отклонение энергии < 5%** при проверке законов сохранения
- **Качественное соответствие** физическим законам (проскальзывание/качение)

## Физические константы

- g = 9.81 м/с² - ускорение свободного падения
- Момент инерции сплошного шара: I = (2/5)·m·r²
- Коэффициент восстановления для упругого удара: e = 1.0

## Примечания

1. Все тесты используют численное интегрирование методом `odeint` из scipy
2. Погрешность зависит от шага интегрирования dt (меньше шаг - выше точность)
3. Некоторые тесты могут показывать незначительные отклонения из-за накопления численной погрешности

